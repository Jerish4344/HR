{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    .profile-edit-header {
        background-color: #f8f9fa;
        border-radius: 0.5rem;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    
    .profile-picture-container {
        position: relative;
        width: 150px;
        height: 150px;
        margin: 0 auto;
    }
    
    .profile-picture {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 50%;
        border: 5px solid white;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }
    
    .profile-picture-overlay {
        position: absolute;
        bottom: 0;
        right: 0;
        background-color: rgba(0, 123, 255, 0.8);
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    .profile-edit-card {
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        margin-bottom: 1.5rem;
    }
    
    .profile-edit-card .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0,0,0,0.125);
        font-weight: 500;
    }
    
    #profile_picture_preview {
        max-width: 100%;
        height: auto;
        border-radius: 50%;
        display: none;
        margin-top: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Profile Edit Header -->
    <div class="profile-edit-header">
        <div class="row align-items-center">
            <div class="col-md-12 text-center">
                <h2 class="mb-4">Edit Profile</h2>
                <div class="profile-picture-container mb-3">
                    {% if employee.profile_picture %}
                        <img src="{{ employee.profile_picture.url }}" alt="{{ employee.full_name }}" class="profile-picture" id="current_profile_picture">
                    {% else %}
                        <div class="profile-picture d-flex align-items-center justify-content-center bg-secondary" id="current_profile_picture">
                            <i class="bi bi-person-fill text-white" style="font-size: 4rem;"></i>
                        </div>
                    {% endif %}
                    <label for="id_profile_picture" class="profile-picture-overlay">
                        <i class="bi bi-camera"></i>
                    </label>
                </div>
                <h5 class="mb-1">{{ employee.full_name }}</h5>
                <p class="text-muted mb-0">{{ employee.employee_id }}</p>
            </div>
        </div>
    </div>
    
    <div class="row justify-content-center">
        <div class="col-md-8">
            <form method="post" enctype="multipart/form-data" novalidate>
                {% csrf_token %}
                
                <!-- Contact Information -->
                <div class="card profile-edit-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-telephone"></i> Contact Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="id_primary_phone" class="form-label">Primary Phone *</label>
                                <input type="tel" class="form-control" id="id_primary_phone" name="primary_phone" value="{{ employee.primary_phone }}" required>
                                <div class="form-text">Enter your primary contact number</div>
                            </div>
                            <div class="col-md-6">
                                <label for="id_secondary_phone" class="form-label">Secondary Phone</label>
                                <input type="tel" class="form-control" id="id_secondary_phone" name="secondary_phone" value="{{ employee.secondary_phone }}">
                                <div class="form-text">Optional alternate contact number</div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="id_personal_email" class="form-label">Personal Email *</label>
                            <input type="email" class="form-control" id="id_personal_email" name="personal_email" value="{{ employee.personal_email }}" required>
                            <div class="form-text">Your personal email address</div>
                        </div>
                        <div class="mb-3">
                            <label for="id_official_email" class="form-label">Official Email</label>
                            <input type="email" class="form-control" id="id_official_email" value="{{ employee.official_email }}" disabled readonly>
                            <div class="form-text">Official email cannot be changed. Contact HR for updates.</div>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Picture -->
                <div class="card profile-edit-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-image"></i> Profile Picture
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="id_profile_picture" class="form-label">Upload New Profile Picture</label>
                            <input type="file" class="form-control" id="id_profile_picture" name="profile_picture" accept="image/*">
                            <div class="form-text">Recommended size: 300x300 pixels. Max file size: 2MB.</div>
                            <img id="profile_picture_preview" src="#" alt="Profile Picture Preview" class="mt-3">
                        </div>
                    </div>
                </div>
                
                <!-- Change Password -->
                <div class="card profile-edit-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-lock"></i> Change Password
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="id_current_password" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="id_current_password" name="current_password">
                            <div class="form-text">Enter your current password to verify</div>
                        </div>
                        <div class="mb-3">
                            <label for="id_new_password" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="id_new_password" name="new_password">
                            <div class="form-text">Password must be at least 8 characters long</div>
                        </div>
                        <div class="mb-3">
                            <label for="id_confirm_password" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="id_confirm_password" name="confirm_password">
                            <div class="form-text">Re-enter your new password</div>
                        </div>
                        <div class="form-text text-muted mb-3">
                            <i class="bi bi-info-circle"></i> Leave password fields empty if you don't want to change your password.
                        </div>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="d-flex justify-content-between mb-4">
                    <a href="{% url 'core:profile' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Preview profile picture before upload
        const profilePictureInput = document.getElementById('id_profile_picture');
        const profilePicturePreview = document.getElementById('profile_picture_preview');
        
        profilePictureInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    profilePicturePreview.src = e.target.result;
                    profilePicturePreview.style.display = 'block';
                }
                
                reader.readAsDataURL(this.files[0]);
            }
        });
        
        // Password confirmation validation
        const newPasswordInput = document.getElementById('id_new_password');
        const confirmPasswordInput = document.getElementById('id_confirm_password');
        const form = document.querySelector('form');
        
        form.addEventListener('submit', function(event) {
            if (newPasswordInput.value && newPasswordInput.value !== confirmPasswordInput.value) {
                event.preventDefault();
                alert('New password and confirmation password do not match.');
                confirmPasswordInput.focus();
            }
        });
    });
</script>
{% endblock %}

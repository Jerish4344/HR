{% extends "base.html" %}
{% load static %}
{% load django_bootstrap5 %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    .notification-list {
        margin-bottom: 2rem;
    }
    
    .notification-item {
        border-left: 4px solid transparent;
        transition: background-color 0.2s;
        margin-bottom: 0.5rem;
    }
    
    .notification-item:hover {
        background-color: rgba(0, 123, 255, 0.05);
    }
    
    .notification-item.unread {
        background-color: rgba(0, 123, 255, 0.05);
    }
    
    .notification-item.low {
        border-left-color: #6c757d;
    }
    
    .notification-item.medium {
        border-left-color: #0d6efd;
    }
    
    .notification-item.high {
        border-left-color: #fd7e14;
    }
    
    .notification-item.urgent {
        border-left-color: #dc3545;
    }
    
    .notification-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .notification-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .notification-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 3rem 1rem;
    }
    
    .empty-state-icon {
        font-size: 4rem;
        color: #6c757d;
        margin-bottom: 1rem;
    }
    
    .notification-time {
        font-size: 0.8rem;
        color: #6c757d;
    }
    
    .priority-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
    }
    
    .priority-low {
        background-color: #6c757d;
    }
    
    .priority-medium {
        background-color: #0d6efd;
    }
    
    .priority-high {
        background-color: #fd7e14;
    }
    
    .priority-urgent {
        background-color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- Header -->
            <div class="notification-header">
                <div>
                    <h2 class="mb-0">Notifications</h2>
                    {% if unread_count > 0 %}
                        <p class="text-muted mb-0">You have {{ unread_count }} unread notification{{ unread_count|pluralize }}</p>
                    {% endif %}
                </div>
                <div class="notification-actions">
                    {% if unread_count > 0 %}
                        <a href="?mark_read=all" class="btn btn-outline-primary">
                            <i class="bi bi-check-all"></i> Mark All as Read
                        </a>
                    {% endif %}
                    <a href="{% url 'core:dashboard' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
            
            <!-- Filter Options -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-4">
                            <label for="filter-status" class="form-label">Status</label>
                            <select class="form-select" id="filter-status" name="status">
                                <option value="">All</option>
                                <option value="unread" {% if request.GET.status == 'unread' %}selected{% endif %}>Unread</option>
                                <option value="read" {% if request.GET.status == 'read' %}selected{% endif %}>Read</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filter-priority" class="form-label">Priority</label>
                            <select class="form-select" id="filter-priority" name="priority">
                                <option value="">All</option>
                                <option value="low" {% if request.GET.priority == 'low' %}selected{% endif %}>Low</option>
                                <option value="medium" {% if request.GET.priority == 'medium' %}selected{% endif %}>Medium</option>
                                <option value="high" {% if request.GET.priority == 'high' %}selected{% endif %}>High</option>
                                <option value="urgent" {% if request.GET.priority == 'urgent' %}selected{% endif %}>Urgent</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="filter-category" class="form-label">Category</label>
                            <select class="form-select" id="filter-category" name="category">
                                <option value="">All</option>
                                <!-- Categories would be dynamically populated -->
                            </select>
                        </div>
                        <div class="col-12 text-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-funnel"></i> Filter
                            </button>
                            <a href="{% url 'core:notifications' %}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> Clear
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Notifications List -->
            <div class="notification-list">
                {% if notifications %}
                    {% for notification in notifications %}
                        <div class="card notification-item {{ notification.priority }} {% if not notification.is_read %}unread{% endif %}">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <h5 class="card-title mb-1">
                                        <span class="priority-indicator priority-{{ notification.priority }}"></span>
                                        {{ notification.title }}
                                    </h5>
                                    <div class="notification-time">
                                        {{ notification.created_at|date:"M d, Y" }} at {{ notification.created_at|time:"H:i" }}
                                        <span class="ms-2 text-muted">({{ notification.created_at|timesince }} ago)</span>
                                    </div>
                                </div>
                                
                                <p class="card-text mb-2">{{ notification.message }}</p>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        {% if notification.category %}
                                            <span class="badge bg-secondary notification-badge">{{ notification.category }}</span>
                                        {% endif %}
                                        
                                        {% if notification.priority == 'high' %}
                                            <span class="badge bg-warning text-dark notification-badge">High Priority</span>
                                        {% elif notification.priority == 'urgent' %}
                                            <span class="badge bg-danger notification-badge">Urgent</span>
                                        {% elif notification.priority == 'medium' %}
                                            <span class="badge bg-primary notification-badge">Medium Priority</span>
                                        {% elif notification.priority == 'low' %}
                                            <span class="badge bg-secondary notification-badge">Low Priority</span>
                                        {% endif %}
                                        
                                        {% if not notification.is_read %}
                                            <span class="badge bg-info notification-badge">New</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="btn-group">
                                        {% if notification.link %}
                                            <a href="{{ notification.link }}" class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-box-arrow-up-right"></i> View Details
                                            </a>
                                        {% endif %}
                                        
                                        {% if not notification.is_read %}
                                            <a href="{% url 'core:mark_notification_read' notification.id %}" class="btn btn-sm btn-outline-secondary">
                                                <i class="bi bi-check"></i> Mark as Read
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    
                    <!-- Pagination -->
                    {% if notifications.has_other_pages %}
                        <nav aria-label="Notifications pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                {% if notifications.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page=1{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" aria-label="First">
                                            <span aria-hidden="true">&laquo;&laquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ notifications.previous_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&laquo;&laquo;</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&laquo;</a>
                                    </li>
                                {% endif %}
                                
                                {% for i in notifications.paginator.page_range %}
                                    {% if notifications.number == i %}
                                        <li class="page-item active" aria-current="page">
                                            <span class="page-link">{{ i }}</span>
                                        </li>
                                    {% elif i > notifications.number|add:'-3' and i < notifications.number|add:'3' %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ i }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">{{ i }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if notifications.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ notifications.next_page_number }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ notifications.paginator.num_pages }}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" aria-label="Last">
                                            <span aria-hidden="true">&raquo;&raquo;</span>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&raquo;</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">&raquo;&raquo;</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}
                {% else %}
                    <!-- Empty State -->
                    <div class="card">
                        <div class="card-body empty-state">
                            <i class="bi bi-bell-slash empty-state-icon"></i>
                            <h4>No Notifications</h4>
                            <p class="text-muted">You don't have any notifications at the moment.</p>
                            <a href="{% url 'core:dashboard' %}" class="btn btn-primary mt-3">
                                <i class="bi bi-arrow-left"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
